{
  "hash": "819d00867e7b025d8ac374cb001f01f8",
  "result": {
    "markdown": "---\ntitle: Burn Severity with Sentinel-2 data using Google Earth Engine\ndescription: Python Work from Jupyter Notebook\neditor: visual\n---\n\nIn this Jupyter Notebook, we first visualize true color images of the August Complex fire before and after it burned. Bands from the Sentinel 2 satellites as well as a dataset from USFS with wildfire boundaries are used for our analysis. Then, the Normalized Burn Ratio (NBR) is used to analyze burn severity, which is a measure of the degree to which a fire has affected the ecosystem. To compare these two images, we will compute the normalized difference to show where burn severity most significantly affected the vegetation and soil. We then added a scale to the normalized difference to show the levels of burn severity from the August Complex fire. Finally, we visualized the levels of severity to show the overall intensity. This link provides more information on the Sentinel 2 dataset that was used: https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S2.\n\n### Authors\n\n-   Guillermo Romero, Bren School of Environmental Science & Management, UCSB (romero61\\@ucsb.edu)\n-   Wade Sedgewick, Bren School of Environmental Science & Management, UCSB (wsedgwick\\@ucsb.edu)\n-   Hailey Veirs, Bren School of Environmental Science & Management, UCSB (hveirs\\@ucsb.edu)\n\n### Table of Contents\n\n1.  [Purpose](#notebook-purpose)\n2.  [Dataset Description](#dataset-description)\n3.  [Data I/O](#data-inputoutput)\n4.  [Metadata Display](#metadata-display)\n5.  [True Color Visualization](#true-color-visualization)\n6.  [Use Case Examples](#use-case-example)\n7.  [Use Case Discussion](#use-case-discussion)\n8.  [References](#references)\n\n# Notebook Purpose\n\nWildfires in California are becoming increasingly straining on the environment as well as the millions of people living in the state. As the world struggles to deal with climate change and droughts in the West, California must be proactive at addressing this threat. This notebook aims at visualizing the severity of the August Complex fire, the largest wildfire by area in California's history. This fire began on August 16th and wasn't contained until November 12th. California's 7 biggest wildfires have all occurred in the past 5 years as California becomes a more draught-prone state, which means that this problem will only get worse. The wildfire started from multiple lightning strikes that resulted in 13 separate fires, and over the following week, they quickly joined to form the August Fire, which lasted just under three months.\n\nTo visualize the severity of the August Complex fire, we will do an analysis of the difference Normalized Burn Ratio (dNBR). Sentinel 2, the satellites used for Europe's Earth observation program, will be used to conduct this analysis. The dNBR is an analysis on quantifying the damage that the fire had on the ecosystem. The NBR before and after the fires is first calculated. We use these images to calculate the dNBR, which shows the difference in burn severity. With Sentinel's Visible and Near Infrared (VNIR) and Shortwave Infrared (SWIR) bands at 20 meter resolution, we are able to visualize the severity of the largest wildlife in California. Lastly, we display the proportion of level of severity, showing how detrimental it was to the environment.\n\n# Dataset Description\n\n**Sentinel 2**\n\nThe dataset we will be using is the Sentinel 2 which was collected and distributed by Copernicus, Europe's Earth observation program. Sentinel 2 uses two separate satellites for increased temporal resolution. These satellites focus on terrestrial monitoring, whereas Sentinel 1 aims at capturing imagery of both marine and terrestrial areas. The Sentinel 2 satellites focus on monitoring coasts, vegetation and soil.\n\n**Resolution**\n\nThe Sentinel 2 satellites collect 13 separate bands. Sentinel 2A was launched June, 2015 and Sentinel 2B was launched March, 2017. Because the Sentinel 2 program comprises of two satellites that rotate the earth every 10 days, an entire cycle is completed in only five days. This increased temporal resolution is more than three times higher than Landsat 8. This is due to the focus on land and near-shore monitoring. The Sentinel satellites collect 13 separate bands: the visible bands have a resolution of 10 meters, five 20 meter and one 10 meter Visible and Near Infrared bands, two 60 meter and two 20-meter Shortwave Infrared bands, and one 60 meter Ultra Blue band (for coastal sediment and aerosols). We will be using a 20-meter NIR band as well as a 20-meter SWIR band for our dNBR analysis.\n\n**File Format & Data Retrieval**\n\nThe data format for Sentinel 2 are ImageCollections, which are a collection of all images as individual bands taken by Sentinel 2A and 2B over their lifetimes. For our analysis, we used Google Earth Engine.\n\n**Limitations**\n\nThe Sentinel 2 satellites have been in orbit for five and seven years, providing highly temporal and decently spatial resolution. However, there are some limitations in using the data. The most prominent is cloud coverage, which affects how much of the earth a satellite can record. Although trends can show where cloud coverage might be more difficult to work around, the randomness and frequency of clouds interfering with imagery collection can mean that researchers do not have access to satellite imagery at a certain date. Additionally, although 10 meters is an improvement to the 30-meter Landsat visible bands, this is still not at a resolution for spatially detailed analysis such as individual tree identification.\n\n**MTBS Polygon Data**\n\nWe will also use the US Forest Service's Monitoring Trends in Burned Severity (MTBS) shapefiles with the Sentinel data. The data is made of shapefiles with several other saved variables such as the acerage of burned area, latitude longitude, ignition date, and dNBR values over certain thresholds. These shapefiles are delineated from Landsat imagery and burn severity index data at a map scale of 1:24,000 to 1:50,000. Additionally, all vector data is in Albers Equal Area projection.\n\nFor this notebook, we will be using the polygon geometry to help subset our Sentinel data to the burned area. Although the MTBS vector data includes high to low burn severity threshold data, it only includes the value that each threshold was determined as, not the area values that correspond to each threshold. Luckily, we can still use the vector data in our case example.\n\n# Data Input/Output\n\nFirst, import the packages we need.\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\n#1) Import all necessary packages\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport datetime\nimport ee\nimport geemap.foliumap as geemap\n```\n:::\n\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\n#ee.Authenticate()\n```\n:::\n\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\nee.Initialize()\n```\n:::\n\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\n# Loading Sentinel-2 MSI: MultiSpectral Instrument, Level-1C\nimagery = ee.ImageCollection('COPERNICUS/S2')\n#Loading Monitoring Trends in Burn Severity (MTBS) Feature Collection Dataset\nMTBS = ee.FeatureCollection(\"USFS/GTAC/MTBS/burned_area_boundaries/v1\")\n```\n:::\n\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\nMap = geemap.Map(center=[39.9, -109], zoom=6.49)\n```\n:::\n\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\nMap.addLayer(MTBS, {}, 'Boundaries')\nMap\n```\n\n::: {.cell-output .cell-output-display execution_count=47}\n```{=html}\n<iframe srcdoc=\"&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    \n    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;\n    \n        &lt;script&gt;\n            L_NO_TOUCH = false;\n            L_DISABLE_3D = false;\n        &lt;/script&gt;\n    \n    &lt;style&gt;html, body {width: 100%;height: 100%;margin: 0;padding: 0;}&lt;/style&gt;\n    &lt;style&gt;#map {position:absolute;top:0;bottom:0;right:0;left:0;}&lt;/style&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://code.jquery.com/jquery-1.12.4.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/&gt;\n    \n            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,\n                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;\n            &lt;style&gt;\n                #map_78a2681da3ccf6ed84590cdb6e1bd5f9 {\n                    position: relative;\n                    width: 100.0%;\n                    height: 100.0%;\n                    left: 0.0%;\n                    top: 0.0%;\n                }\n                .leaflet-container { font-size: 1rem; }\n            &lt;/style&gt;\n        \n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.2/Control.FullScreen.min.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.2/Control.FullScreen.min.css&quot;/&gt;\n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.css&quot;/&gt;\n    &lt;script src=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css&quot;/&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    \n    \n            &lt;div class=&quot;folium-map&quot; id=&quot;map_78a2681da3ccf6ed84590cdb6e1bd5f9&quot; &gt;&lt;/div&gt;\n        \n&lt;/body&gt;\n&lt;script&gt;\n    \n    \n            var map_78a2681da3ccf6ed84590cdb6e1bd5f9 = L.map(\n                &quot;map_78a2681da3ccf6ed84590cdb6e1bd5f9&quot;,\n                {\n                    center: [39.9, -109.0],\n                    crs: L.CRS.EPSG3857,\n                    zoom: 6.49,\n                    zoomControl: true,\n                    preferCanvas: false,\n                    eeInitialize: true,\n                    addGoogleMap: true,\n                    pluginLatlngpopup: false,\n                    pluginFullscreen: true,\n                    pluginDraw: true,\n                    DrawExport: false,\n                    pluginMinimap: false,\n                    locateControl: false,\n                    searchControl: true,\n                    layersControl: true,\n                }\n            );\n\n            \n\n        \n    \n            var tile_layer_64f5a4f7fd734f4ec6ad339c6446331d = L.tileLayer(\n                &quot;https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,\n                {&quot;attribution&quot;: &quot;Data by \\u0026copy; \\u003ca target=\\&quot;_blank\\&quot; href=\\&quot;http://openstreetmap.org\\&quot;\\u003eOpenStreetMap\\u003c/a\\u003e, under \\u003ca target=\\&quot;_blank\\&quot; href=\\&quot;http://www.openstreetmap.org/copyright\\&quot;\\u003eODbL\\u003c/a\\u003e.&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 30, &quot;maxZoom&quot;: 30, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_78a2681da3ccf6ed84590cdb6e1bd5f9);\n        \n    \n            var tile_layer_28dd10f4244495907baa11178e8ad662 = L.tileLayer(\n                &quot;https://mt1.google.com/vt/lyrs=m\\u0026x={x}\\u0026y={y}\\u0026z={z}&quot;,\n                {&quot;attribution&quot;: &quot;Google&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 22, &quot;maxZoom&quot;: 22, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_78a2681da3ccf6ed84590cdb6e1bd5f9);\n        \n    \n            L.control.fullscreen(\n                {&quot;forceSeparateButton&quot;: false, &quot;position&quot;: &quot;topleft&quot;, &quot;title&quot;: &quot;Full Screen&quot;, &quot;titleCancel&quot;: &quot;Exit Full Screen&quot;}\n            ).addTo(map_78a2681da3ccf6ed84590cdb6e1bd5f9);\n        \n    \n            var options = {\n              position: &quot;topleft&quot;,\n              draw: {},\n              edit: {},\n            }\n            // FeatureGroup is to store editable layers.\n            var drawnItems = new L.featureGroup().addTo(\n                map_78a2681da3ccf6ed84590cdb6e1bd5f9\n            );\n            options.edit.featureGroup = drawnItems;\n            var draw_control_baabbba7bdb9ece8ce999c19170b5123 = new L.Control.Draw(\n                options\n            ).addTo( map_78a2681da3ccf6ed84590cdb6e1bd5f9 );\n            map_78a2681da3ccf6ed84590cdb6e1bd5f9.on(L.Draw.Event.CREATED, function(e) {\n                var layer = e.layer,\n                    type = e.layerType;\n                var coords = JSON.stringify(layer.toGeoJSON());\n                layer.on(&#x27;click&#x27;, function() {\n                    alert(coords);\n                    console.log(coords);\n                });\n                drawnItems.addLayer(layer);\n             });\n            map_78a2681da3ccf6ed84590cdb6e1bd5f9.on(&#x27;draw:created&#x27;, function(e) {\n                drawnItems.addLayer(e.layer);\n            });\n            \n        \n    \n            L.Control.geocoder(\n                {&quot;collapsed&quot;: true, &quot;defaultMarkGeocode&quot;: true, &quot;position&quot;: &quot;topleft&quot;}\n            ).on(&#x27;markgeocode&#x27;, function(e) {\n                map_78a2681da3ccf6ed84590cdb6e1bd5f9.setView(e.geocode.center, 11);\n            }).addTo(map_78a2681da3ccf6ed84590cdb6e1bd5f9);\n\n        \n    \n            map_78a2681da3ccf6ed84590cdb6e1bd5f9.fitBounds(\n                [[39.9, -109], [39.9, -109]],\n                {&quot;maxZoom&quot;: 6.49}\n            );\n        \n    \n            var tile_layer_eedb5a7e98a5ae8c747d5cf9a0994fd7 = L.tileLayer(\n                &quot;https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/4bdc6d5792d036771844b22128e20cad-088f065e04aea662b4f9cbf073a4f094/tiles/{z}/{x}/{y}&quot;,\n                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_78a2681da3ccf6ed84590cdb6e1bd5f9);\n        \n    \n            var layer_control_2d657dbd88d6e8f5e4a1c40c151aa6c3 = {\n                base_layers : {\n                    &quot;openstreetmap&quot; : tile_layer_64f5a4f7fd734f4ec6ad339c6446331d,\n                },\n                overlays :  {\n                    &quot;Google Maps&quot; : tile_layer_28dd10f4244495907baa11178e8ad662,\n                    &quot;Boundaries&quot; : tile_layer_eedb5a7e98a5ae8c747d5cf9a0994fd7,\n                },\n            };\n            L.control.layers(\n                layer_control_2d657dbd88d6e8f5e4a1c40c151aa6c3.base_layers,\n                layer_control_2d657dbd88d6e8f5e4a1c40c151aa6c3.overlays,\n                {&quot;autoZIndex&quot;: true, &quot;collapsed&quot;: true, &quot;position&quot;: &quot;topright&quot;}\n            ).addTo(map_78a2681da3ccf6ed84590cdb6e1bd5f9);\n        \n&lt;/script&gt;\n&lt;/html&gt;\" width=\"100%\" height=\"600\"style=\"border:none !important;\" \"allowfullscreen\" \"webkitallowfullscreen\" \"mozallowfullscreen\"></iframe>\n```\n:::\n:::\n\n\n# Metadata Display\n\n::: {.cell jupyter='{\"outputs_hidden\":true}' tags='[]' execution_count=7}\n``` {.python .cell-code}\n# Show the metadata of the Sentinel raster data.\n#testimg = imagery.first()\n#testimg.getInfo()\n```\n:::\n\n\n::: {.cell jupyter='{\"outputs_hidden\":true}' tags='[]' execution_count=8}\n``` {.python .cell-code}\n# Show the metadata of the MTBS vector data.\n#shape = MTBS.first()\n#shape.getInfo()\n#MTBS.limit(1).getInfo()\n```\n:::\n\n\n::: {.cell execution_count=9}\n``` {.python .cell-code}\n# Below is an additional way to subset data using a Feature Collection:\n# Needs to be seperated into different code blocks to run\n#counties = ee.FeatureCollection(\"TIGER/2018/Counties\")\n#Map.addLayer(counties, {}, 'US Counties')\n##### DRAW POLYGON TO SELECT COUNTIES! ####\n#Map.draw_features\n#roi = ee.FeatureCollection(Map.draw_features)\n#selected_counties = counties.filterBounds(roi)\n#Map.addLayer(selected_counties, {}, \"Selected Counties\")\n#Map.centerObject(selected_counties, zoom = 8);\n#august_complex = MTBS.filterBounds(roi)\n#Map.addLayer(august_complex, {}, \"August Complex Boundary\")\n#Map.centerObject(august_complex, zoom = 8);\n#Map.remove_last_drawn()\n\n#Map.remove_ee_layer('US Counties')\n#Map.remove_ee_layer('August Complex Boundary')\n#c_polygon = selected_counties.geometry().geometries().filter(ee.Filter.hasType('item','Polygon')); \n#geometry = ee.Geometry.MultiPolygon(c_polygon)                     \n#geometry = ee.FeatureCollection(geometry)  \n#geemap.ee_to_shp(geometry, filename='../downloads/selected_counties.shp')\n```\n:::\n\n\n# True Color Visualization\n\nStart off by making a true color image of our use case example. This will show how the Sentinel data looks, as well as how we filter it to based on the MTBS shapefile.\n\n::: {.cell tags='[]' execution_count=10}\n``` {.python .cell-code}\naug_complex = MTBS.filter(ee.Filter.eq('Incid_Name', 'AUGUST COMPLEX'));\n```\n:::\n\n\n::: {.cell jupyter='{\"outputs_hidden\":true}' tags='[]' execution_count=11}\n``` {.python .cell-code}\n#august_complex.getInfo()\n#aug_complex.getInfo()\n#BurnBndAc\tINT\t Burn boundary acreage  1068802\n```\n:::\n\n\n::: {.cell execution_count=12}\n``` {.python .cell-code}\nMapB = geemap.Map(center=[39.9, -122.9], zoom=8.7)\n```\n:::\n\n\n::: {.cell execution_count=13}\n``` {.python .cell-code}\nMapB.addLayer(aug_complex, {}, \"August Complex Boundary\")\n#Map.centerObject(selected_counties, zoom = 9);\n#Map.remove_ee_layer('Boundaries')\nMapB\n```\n\n::: {.cell-output .cell-output-display execution_count=54}\n```{=html}\n<iframe srcdoc=\"&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    \n    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;\n    \n        &lt;script&gt;\n            L_NO_TOUCH = false;\n            L_DISABLE_3D = false;\n        &lt;/script&gt;\n    \n    &lt;style&gt;html, body {width: 100%;height: 100%;margin: 0;padding: 0;}&lt;/style&gt;\n    &lt;style&gt;#map {position:absolute;top:0;bottom:0;right:0;left:0;}&lt;/style&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://code.jquery.com/jquery-1.12.4.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/&gt;\n    \n            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,\n                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;\n            &lt;style&gt;\n                #map_ae5725431b67e77c9e6e14812e64c68f {\n                    position: relative;\n                    width: 100.0%;\n                    height: 100.0%;\n                    left: 0.0%;\n                    top: 0.0%;\n                }\n                .leaflet-container { font-size: 1rem; }\n            &lt;/style&gt;\n        \n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.2/Control.FullScreen.min.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.2/Control.FullScreen.min.css&quot;/&gt;\n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.css&quot;/&gt;\n    &lt;script src=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css&quot;/&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    \n    \n            &lt;div class=&quot;folium-map&quot; id=&quot;map_ae5725431b67e77c9e6e14812e64c68f&quot; &gt;&lt;/div&gt;\n        \n&lt;/body&gt;\n&lt;script&gt;\n    \n    \n            var map_ae5725431b67e77c9e6e14812e64c68f = L.map(\n                &quot;map_ae5725431b67e77c9e6e14812e64c68f&quot;,\n                {\n                    center: [39.9, -122.9],\n                    crs: L.CRS.EPSG3857,\n                    zoom: 8.7,\n                    zoomControl: true,\n                    preferCanvas: false,\n                    eeInitialize: true,\n                    addGoogleMap: true,\n                    pluginLatlngpopup: false,\n                    pluginFullscreen: true,\n                    pluginDraw: true,\n                    DrawExport: false,\n                    pluginMinimap: false,\n                    locateControl: false,\n                    searchControl: true,\n                    layersControl: true,\n                }\n            );\n\n            \n\n        \n    \n            var tile_layer_9e37c7ff4308aec8882ce231046e1ef5 = L.tileLayer(\n                &quot;https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,\n                {&quot;attribution&quot;: &quot;Data by \\u0026copy; \\u003ca target=\\&quot;_blank\\&quot; href=\\&quot;http://openstreetmap.org\\&quot;\\u003eOpenStreetMap\\u003c/a\\u003e, under \\u003ca target=\\&quot;_blank\\&quot; href=\\&quot;http://www.openstreetmap.org/copyright\\&quot;\\u003eODbL\\u003c/a\\u003e.&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 30, &quot;maxZoom&quot;: 30, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_ae5725431b67e77c9e6e14812e64c68f);\n        \n    \n            var tile_layer_28dd10f4244495907baa11178e8ad662 = L.tileLayer(\n                &quot;https://mt1.google.com/vt/lyrs=m\\u0026x={x}\\u0026y={y}\\u0026z={z}&quot;,\n                {&quot;attribution&quot;: &quot;Google&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 22, &quot;maxZoom&quot;: 22, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_ae5725431b67e77c9e6e14812e64c68f);\n        \n    \n            L.control.fullscreen(\n                {&quot;forceSeparateButton&quot;: false, &quot;position&quot;: &quot;topleft&quot;, &quot;title&quot;: &quot;Full Screen&quot;, &quot;titleCancel&quot;: &quot;Exit Full Screen&quot;}\n            ).addTo(map_ae5725431b67e77c9e6e14812e64c68f);\n        \n    \n            var options = {\n              position: &quot;topleft&quot;,\n              draw: {},\n              edit: {},\n            }\n            // FeatureGroup is to store editable layers.\n            var drawnItems = new L.featureGroup().addTo(\n                map_ae5725431b67e77c9e6e14812e64c68f\n            );\n            options.edit.featureGroup = drawnItems;\n            var draw_control_74bef55742cf67063c074dcbba771d27 = new L.Control.Draw(\n                options\n            ).addTo( map_ae5725431b67e77c9e6e14812e64c68f );\n            map_ae5725431b67e77c9e6e14812e64c68f.on(L.Draw.Event.CREATED, function(e) {\n                var layer = e.layer,\n                    type = e.layerType;\n                var coords = JSON.stringify(layer.toGeoJSON());\n                layer.on(&#x27;click&#x27;, function() {\n                    alert(coords);\n                    console.log(coords);\n                });\n                drawnItems.addLayer(layer);\n             });\n            map_ae5725431b67e77c9e6e14812e64c68f.on(&#x27;draw:created&#x27;, function(e) {\n                drawnItems.addLayer(e.layer);\n            });\n            \n        \n    \n            L.Control.geocoder(\n                {&quot;collapsed&quot;: true, &quot;defaultMarkGeocode&quot;: true, &quot;position&quot;: &quot;topleft&quot;}\n            ).on(&#x27;markgeocode&#x27;, function(e) {\n                map_ae5725431b67e77c9e6e14812e64c68f.setView(e.geocode.center, 11);\n            }).addTo(map_ae5725431b67e77c9e6e14812e64c68f);\n\n        \n    \n            map_ae5725431b67e77c9e6e14812e64c68f.fitBounds(\n                [[39.9, -122.9], [39.9, -122.9]],\n                {&quot;maxZoom&quot;: 8.7}\n            );\n        \n    \n            var tile_layer_f7c7cfe1530a909319c571e73a99ce22 = L.tileLayer(\n                &quot;https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/f2bd23c1d1b2c52fac8fb9371049643a-21d9a3f1777679ac05c238cc1a6d7836/tiles/{z}/{x}/{y}&quot;,\n                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_ae5725431b67e77c9e6e14812e64c68f);\n        \n    \n            var layer_control_9344545548fae32ec42847c98cf5e9be = {\n                base_layers : {\n                    &quot;openstreetmap&quot; : tile_layer_9e37c7ff4308aec8882ce231046e1ef5,\n                },\n                overlays :  {\n                    &quot;Google Maps&quot; : tile_layer_28dd10f4244495907baa11178e8ad662,\n                    &quot;August Complex Boundary&quot; : tile_layer_f7c7cfe1530a909319c571e73a99ce22,\n                },\n            };\n            L.control.layers(\n                layer_control_9344545548fae32ec42847c98cf5e9be.base_layers,\n                layer_control_9344545548fae32ec42847c98cf5e9be.overlays,\n                {&quot;autoZIndex&quot;: true, &quot;collapsed&quot;: true, &quot;position&quot;: &quot;topright&quot;}\n            ).addTo(map_ae5725431b67e77c9e6e14812e64c68f);\n        \n&lt;/script&gt;\n&lt;/html&gt;\" width=\"100%\" height=\"600\"style=\"border:none !important;\" \"allowfullscreen\" \"webkitallowfullscreen\" \"mozallowfullscreen\"></iframe>\n```\n:::\n:::\n\n\nThe code below is outlining and saving time frames before the start of the fire and after the end of the fire. We chose to do \\~15 day timeframes because the Sentinel satellite images are taken approximately every 5 days. The \\~15 day timeframe means that we will hopefully have 2-3 images to use in our analysis.\n\n::: {.cell execution_count=14}\n``` {.python .cell-code}\n# Start of fire August 16\n# End of fire November 12\nprefire_start = '2020-07-15';   \nprefire_end = '2020-07-30';\n\n\npostfire_start = '2020-11-13';\npostfire_end = '2020-11-30';\n# Load the Sentinel data\nimagery = ee.ImageCollection('COPERNICUS/S2')\n\n# Filter the Image collection based on the timeframes. \n# Filter the cells to the MTBS polygon.\nprefireImCol = ee.ImageCollection(imagery.filterDate(prefire_start, prefire_end).filterBounds(aug_complex));\npostfireImCol = ee.ImageCollection(imagery.filterDate(postfire_start, postfire_end).filterBounds(aug_complex));\n```\n:::\n\n\n::: {.cell execution_count=15}\n``` {.python .cell-code}\n# Function to mask clouds from the pixel quality band of Sentinel-2 SR data.\ndef  maskS2sr(image):\n  # Bits 10 and 11 are clouds and cirrus, respectively.\n    cloudBitMask = ee.Number(2).pow(10).int();\n    cirrusBitMask = ee.Number(2).pow(11).int();\n  #Get the pixel QA band.\n    qa = image.select('QA60');\n  #All flags should be set to zero, indicating clear conditions.\n    mask = qa.bitwiseAnd(cloudBitMask).eq(0).bitwiseAnd(cirrusBitMask).eq(0);\n  #Return the masked image, scaled to TOA reflectance, without the QA bands.\n    return image.updateMask(mask).copyProperties(image, [\"system:time_start\"]);\n```\n:::\n\n\n::: {.cell execution_count=16}\n``` {.python .cell-code}\n# Apply platform-specific cloud mask\nprefire_CM_ImCol = prefireImCol.map(maskS2sr);\npostfire_CM_ImCol = postfireImCol.map(maskS2sr);\n```\n:::\n\n\nThe code below creates a mosaic of images if our polygon includes the boundaries between images. It creates and saves one continuous image instead of multiple images.\n\n::: {.cell execution_count=17}\n``` {.python .cell-code}\n# If multiple images in area creates mosaic and clips otherwise only clips\n# Without CLoud Mask\n\npre_mos = prefireImCol.mosaic().clip(aug_complex);\npost_mos = postfireImCol.mosaic().clip(aug_complex);\n# With Cloud Mask\npre_cm_mos = prefire_CM_ImCol.mosaic().clip(aug_complex);\npost_cm_mos = postfire_CM_ImCol.mosaic().clip(aug_complex);\n```\n:::\n\n\nSet up parameters for true color images using band 2, 3, and 4 from the Sentinel satellites, and adding non-cloud masked pre-fire and post-fire images and cloud masked pre-fire and post-fire images\n\n::: {.cell execution_count=18}\n``` {.python .cell-code}\n#visualization parameters for true color images\nvis = {'bands': ['B4', 'B3', 'B2'], 'max': 2000, 'gamma': 1.5};\nMapT = geemap.Map(center=[39.9, -122.9], zoom=8.7)\n```\n:::\n\n\n::: {.cell execution_count=19}\n``` {.python .cell-code}\n# Add the true color images to the map.\nMapT.addLayer(pre_mos, vis,'Pre-fire image');\nMapT.addLayer(post_mos, vis,'Post-fire image');\n#Add the true color images to the map.\nMapT.addLayer(pre_cm_mos, vis,'Pre-fire True Color Image - Clouds masked');\nMapT.addLayer(post_cm_mos, vis,'Post-fire True Color Image - Clouds masked');\nMapT\n```\n\n::: {.cell-output .cell-output-display execution_count=60}\n```{=html}\n<iframe srcdoc=\"&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    \n    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;\n    \n        &lt;script&gt;\n            L_NO_TOUCH = false;\n            L_DISABLE_3D = false;\n        &lt;/script&gt;\n    \n    &lt;style&gt;html, body {width: 100%;height: 100%;margin: 0;padding: 0;}&lt;/style&gt;\n    &lt;style&gt;#map {position:absolute;top:0;bottom:0;right:0;left:0;}&lt;/style&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://code.jquery.com/jquery-1.12.4.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/&gt;\n    \n            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,\n                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;\n            &lt;style&gt;\n                #map_93b1243761e5337af9a62c3093745ef1 {\n                    position: relative;\n                    width: 100.0%;\n                    height: 100.0%;\n                    left: 0.0%;\n                    top: 0.0%;\n                }\n                .leaflet-container { font-size: 1rem; }\n            &lt;/style&gt;\n        \n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.2/Control.FullScreen.min.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.2/Control.FullScreen.min.css&quot;/&gt;\n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.css&quot;/&gt;\n    &lt;script src=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css&quot;/&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    \n    \n            &lt;div class=&quot;folium-map&quot; id=&quot;map_93b1243761e5337af9a62c3093745ef1&quot; &gt;&lt;/div&gt;\n        \n&lt;/body&gt;\n&lt;script&gt;\n    \n    \n            var map_93b1243761e5337af9a62c3093745ef1 = L.map(\n                &quot;map_93b1243761e5337af9a62c3093745ef1&quot;,\n                {\n                    center: [39.9, -122.9],\n                    crs: L.CRS.EPSG3857,\n                    zoom: 8.7,\n                    zoomControl: true,\n                    preferCanvas: false,\n                    eeInitialize: true,\n                    addGoogleMap: true,\n                    pluginLatlngpopup: false,\n                    pluginFullscreen: true,\n                    pluginDraw: true,\n                    DrawExport: false,\n                    pluginMinimap: false,\n                    locateControl: false,\n                    searchControl: true,\n                    layersControl: true,\n                }\n            );\n\n            \n\n        \n    \n            var tile_layer_84245c0a3d9288689b548fb669abfe52 = L.tileLayer(\n                &quot;https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,\n                {&quot;attribution&quot;: &quot;Data by \\u0026copy; \\u003ca target=\\&quot;_blank\\&quot; href=\\&quot;http://openstreetmap.org\\&quot;\\u003eOpenStreetMap\\u003c/a\\u003e, under \\u003ca target=\\&quot;_blank\\&quot; href=\\&quot;http://www.openstreetmap.org/copyright\\&quot;\\u003eODbL\\u003c/a\\u003e.&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 30, &quot;maxZoom&quot;: 30, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_93b1243761e5337af9a62c3093745ef1);\n        \n    \n            var tile_layer_28dd10f4244495907baa11178e8ad662 = L.tileLayer(\n                &quot;https://mt1.google.com/vt/lyrs=m\\u0026x={x}\\u0026y={y}\\u0026z={z}&quot;,\n                {&quot;attribution&quot;: &quot;Google&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 22, &quot;maxZoom&quot;: 22, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_93b1243761e5337af9a62c3093745ef1);\n        \n    \n            L.control.fullscreen(\n                {&quot;forceSeparateButton&quot;: false, &quot;position&quot;: &quot;topleft&quot;, &quot;title&quot;: &quot;Full Screen&quot;, &quot;titleCancel&quot;: &quot;Exit Full Screen&quot;}\n            ).addTo(map_93b1243761e5337af9a62c3093745ef1);\n        \n    \n            var options = {\n              position: &quot;topleft&quot;,\n              draw: {},\n              edit: {},\n            }\n            // FeatureGroup is to store editable layers.\n            var drawnItems = new L.featureGroup().addTo(\n                map_93b1243761e5337af9a62c3093745ef1\n            );\n            options.edit.featureGroup = drawnItems;\n            var draw_control_e3dc86144e329ee22307749629949129 = new L.Control.Draw(\n                options\n            ).addTo( map_93b1243761e5337af9a62c3093745ef1 );\n            map_93b1243761e5337af9a62c3093745ef1.on(L.Draw.Event.CREATED, function(e) {\n                var layer = e.layer,\n                    type = e.layerType;\n                var coords = JSON.stringify(layer.toGeoJSON());\n                layer.on(&#x27;click&#x27;, function() {\n                    alert(coords);\n                    console.log(coords);\n                });\n                drawnItems.addLayer(layer);\n             });\n            map_93b1243761e5337af9a62c3093745ef1.on(&#x27;draw:created&#x27;, function(e) {\n                drawnItems.addLayer(e.layer);\n            });\n            \n        \n    \n            L.Control.geocoder(\n                {&quot;collapsed&quot;: true, &quot;defaultMarkGeocode&quot;: true, &quot;position&quot;: &quot;topleft&quot;}\n            ).on(&#x27;markgeocode&#x27;, function(e) {\n                map_93b1243761e5337af9a62c3093745ef1.setView(e.geocode.center, 11);\n            }).addTo(map_93b1243761e5337af9a62c3093745ef1);\n\n        \n    \n            map_93b1243761e5337af9a62c3093745ef1.fitBounds(\n                [[39.9, -122.9], [39.9, -122.9]],\n                {&quot;maxZoom&quot;: 8.7}\n            );\n        \n    \n            var tile_layer_e12754a5b7d3558621ac0a8806548059 = L.tileLayer(\n                &quot;https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/a97646e6bf5a4405c8cd6b3c1632da50-45abb0fcca79509ef30372618f2787da/tiles/{z}/{x}/{y}&quot;,\n                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_93b1243761e5337af9a62c3093745ef1);\n        \n    \n            var tile_layer_8b198c52e9d326a5b00010c8e3200f61 = L.tileLayer(\n                &quot;https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/d9169ce566aad6a9d96ab879812a3cee-0d4fd8f4744d3fc106b1fcd542686e91/tiles/{z}/{x}/{y}&quot;,\n                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_93b1243761e5337af9a62c3093745ef1);\n        \n    \n            var tile_layer_7116306c93d8cc0b2fc5879061aaa55b = L.tileLayer(\n                &quot;https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/9552ad21d62b7a2d19fa643499be6478-25c33ed3c887d273d7ca716a8a431d70/tiles/{z}/{x}/{y}&quot;,\n                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_93b1243761e5337af9a62c3093745ef1);\n        \n    \n            var tile_layer_5c20ed6e77bcc0bf6a44654378d3d4ab = L.tileLayer(\n                &quot;https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/db899ab5f2c454fb242b19b6ed24aa2e-e883a1ed733e8d469fc6464d50ac78f8/tiles/{z}/{x}/{y}&quot;,\n                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_93b1243761e5337af9a62c3093745ef1);\n        \n    \n            var layer_control_854961952ad8742fafa7bfdbee64fac6 = {\n                base_layers : {\n                    &quot;openstreetmap&quot; : tile_layer_84245c0a3d9288689b548fb669abfe52,\n                },\n                overlays :  {\n                    &quot;Google Maps&quot; : tile_layer_28dd10f4244495907baa11178e8ad662,\n                    &quot;Pre-fire image&quot; : tile_layer_e12754a5b7d3558621ac0a8806548059,\n                    &quot;Post-fire image&quot; : tile_layer_8b198c52e9d326a5b00010c8e3200f61,\n                    &quot;Pre-fire True Color Image - Clouds masked&quot; : tile_layer_7116306c93d8cc0b2fc5879061aaa55b,\n                    &quot;Post-fire True Color Image - Clouds masked&quot; : tile_layer_5c20ed6e77bcc0bf6a44654378d3d4ab,\n                },\n            };\n            L.control.layers(\n                layer_control_854961952ad8742fafa7bfdbee64fac6.base_layers,\n                layer_control_854961952ad8742fafa7bfdbee64fac6.overlays,\n                {&quot;autoZIndex&quot;: true, &quot;collapsed&quot;: true, &quot;position&quot;: &quot;topright&quot;}\n            ).addTo(map_93b1243761e5337af9a62c3093745ef1);\n        \n&lt;/script&gt;\n&lt;/html&gt;\" width=\"100%\" height=\"600\"style=\"border:none !important;\" \"allowfullscreen\" \"webkitallowfullscreen\" \"mozallowfullscreen\"></iframe>\n```\n:::\n:::\n\n\n# Use Case Example\n\nFor our use case, we wanted to use Sentinel data to understand how severe the August Complex fire was in 2020. We will use the Sentinel data to calculate the NBR and dNBR of the fire. It lasted from August 16th to November 12th, and it burned over a million acres accross multiple national parks - largely in the Mendocino National Forest.\n\n## NBRs in greyscale\n\nThe Normalized Burn Ratio (NBR) is the ratio between NIR and SWIR, as shown by the equation below:\n\n![image.png](img/nbreqn.png)\n\nThe Normalized Burn Ratio (NBR) is used to highlight burned areas and estimate burn severity, using near-infrared (NIR) and shortwave-infrared (SWIR) wavelengths. Healthy vegetation has very high NIR reflectance and low SWIR. Recently burned areas have a low NIR reflectance and high SWIR reflectance.\n\nThe spectral response curves of healthy vegetation versus burned vegetation is shown below. Since the two reach peak differences in the NIR and SWIR wavelengths, we can calculate the ratio of this difference to focus on where the August Complex fire burned.\n\n![image.png](img/nbrcurve.png)\n\nPreparing pre-fire and post-fire Normalized Burn Ratio (NBR) images:\n\n::: {.cell execution_count=20}\n``` {.python .cell-code}\npreNBR = pre_cm_mos.normalizedDifference(['B8', 'B12']);\npostNBR = post_cm_mos.normalizedDifference(['B8', 'B12']);\n```\n:::\n\n\n## Creating an interactive map of pre-fire and post-fire NBRs\n\n::: {.cell execution_count=21}\n``` {.python .cell-code}\n#Burn Ratio Product - Greyscale\ngrey = ['white', 'black'];\nleft_layer = geemap.ee_tile_layer(preNBR, {'min': -1, 'max': 1, 'palette': grey}, 'Prefire Normalized Burn Ratio')\nright_layer = geemap.ee_tile_layer(postNBR, {'min': -1, 'max': 1, 'palette': grey}, 'Postfire Normalized Burn Ratio')\n\nMaps =  geemap.Map(center=[39.9, -122.9], zoom=8.7)\n\nMaps.split_map(left_layer, right_layer)\nMaps\n```\n\n::: {.cell-output .cell-output-display execution_count=62}\n```{=html}\n<iframe srcdoc=\"&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    \n    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;\n    \n        &lt;script&gt;\n            L_NO_TOUCH = false;\n            L_DISABLE_3D = false;\n        &lt;/script&gt;\n    \n    &lt;style&gt;html, body {width: 100%;height: 100%;margin: 0;padding: 0;}&lt;/style&gt;\n    &lt;style&gt;#map {position:absolute;top:0;bottom:0;right:0;left:0;}&lt;/style&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://code.jquery.com/jquery-1.12.4.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/&gt;\n    \n            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,\n                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;\n            &lt;style&gt;\n                #map_abd1b4dcc6f5dfcfe61904dc5436bded {\n                    position: relative;\n                    width: 100.0%;\n                    height: 100.0%;\n                    left: 0.0%;\n                    top: 0.0%;\n                }\n                .leaflet-container { font-size: 1rem; }\n            &lt;/style&gt;\n        \n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.2/Control.FullScreen.min.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.2/Control.FullScreen.min.css&quot;/&gt;\n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.css&quot;/&gt;\n    &lt;script src=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css&quot;/&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/gh/digidem/leaflet-side-by-side@gh-pages/leaflet-side-by-side.min.js&quot;&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    \n    \n            &lt;div class=&quot;folium-map&quot; id=&quot;map_abd1b4dcc6f5dfcfe61904dc5436bded&quot; &gt;&lt;/div&gt;\n        \n&lt;/body&gt;\n&lt;script&gt;\n    \n    \n            var map_abd1b4dcc6f5dfcfe61904dc5436bded = L.map(\n                &quot;map_abd1b4dcc6f5dfcfe61904dc5436bded&quot;,\n                {\n                    center: [39.9, -122.9],\n                    crs: L.CRS.EPSG3857,\n                    zoom: 8.7,\n                    zoomControl: true,\n                    preferCanvas: false,\n                    eeInitialize: true,\n                    addGoogleMap: true,\n                    pluginLatlngpopup: false,\n                    pluginFullscreen: true,\n                    pluginDraw: true,\n                    DrawExport: false,\n                    pluginMinimap: false,\n                    locateControl: false,\n                    searchControl: true,\n                    layersControl: true,\n                }\n            );\n\n            \n\n        \n    \n            var tile_layer_103f7a29edc7a9f11123dd6ccca13ff9 = L.tileLayer(\n                &quot;https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,\n                {&quot;attribution&quot;: &quot;Data by \\u0026copy; \\u003ca target=\\&quot;_blank\\&quot; href=\\&quot;http://openstreetmap.org\\&quot;\\u003eOpenStreetMap\\u003c/a\\u003e, under \\u003ca target=\\&quot;_blank\\&quot; href=\\&quot;http://www.openstreetmap.org/copyright\\&quot;\\u003eODbL\\u003c/a\\u003e.&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 30, &quot;maxZoom&quot;: 30, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_abd1b4dcc6f5dfcfe61904dc5436bded);\n        \n    \n            var tile_layer_28dd10f4244495907baa11178e8ad662 = L.tileLayer(\n                &quot;https://mt1.google.com/vt/lyrs=m\\u0026x={x}\\u0026y={y}\\u0026z={z}&quot;,\n                {&quot;attribution&quot;: &quot;Google&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 22, &quot;maxZoom&quot;: 22, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_abd1b4dcc6f5dfcfe61904dc5436bded);\n        \n    \n            L.control.fullscreen(\n                {&quot;forceSeparateButton&quot;: false, &quot;position&quot;: &quot;topleft&quot;, &quot;title&quot;: &quot;Full Screen&quot;, &quot;titleCancel&quot;: &quot;Exit Full Screen&quot;}\n            ).addTo(map_abd1b4dcc6f5dfcfe61904dc5436bded);\n        \n    \n            var options = {\n              position: &quot;topleft&quot;,\n              draw: {},\n              edit: {},\n            }\n            // FeatureGroup is to store editable layers.\n            var drawnItems = new L.featureGroup().addTo(\n                map_abd1b4dcc6f5dfcfe61904dc5436bded\n            );\n            options.edit.featureGroup = drawnItems;\n            var draw_control_4bb09781d0d457d55d18bab4f330af56 = new L.Control.Draw(\n                options\n            ).addTo( map_abd1b4dcc6f5dfcfe61904dc5436bded );\n            map_abd1b4dcc6f5dfcfe61904dc5436bded.on(L.Draw.Event.CREATED, function(e) {\n                var layer = e.layer,\n                    type = e.layerType;\n                var coords = JSON.stringify(layer.toGeoJSON());\n                layer.on(&#x27;click&#x27;, function() {\n                    alert(coords);\n                    console.log(coords);\n                });\n                drawnItems.addLayer(layer);\n             });\n            map_abd1b4dcc6f5dfcfe61904dc5436bded.on(&#x27;draw:created&#x27;, function(e) {\n                drawnItems.addLayer(e.layer);\n            });\n            \n        \n    \n            L.Control.geocoder(\n                {&quot;collapsed&quot;: true, &quot;defaultMarkGeocode&quot;: true, &quot;position&quot;: &quot;topleft&quot;}\n            ).on(&#x27;markgeocode&#x27;, function(e) {\n                map_abd1b4dcc6f5dfcfe61904dc5436bded.setView(e.geocode.center, 11);\n            }).addTo(map_abd1b4dcc6f5dfcfe61904dc5436bded);\n\n        \n    \n            map_abd1b4dcc6f5dfcfe61904dc5436bded.fitBounds(\n                [[39.9, -122.9], [39.9, -122.9]],\n                {&quot;maxZoom&quot;: 8.7}\n            );\n        \n    \n            var tile_layer_142f8abcf036db58d3cd37e955e4581d = L.tileLayer(\n                &quot;https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/9ef914ad22d2c56b2d6a2525654880df-8f96b8678437052e82e1632aca824200/tiles/{z}/{x}/{y}&quot;,\n                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_abd1b4dcc6f5dfcfe61904dc5436bded);\n        \n    \n            var tile_layer_1c4443772780c4304e848d16b4780df3 = L.tileLayer(\n                &quot;https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/cc388607f099babd0a6b3daf43f50d10-d1f929b7c60294b2a0d1ffbdfaf1c797/tiles/{z}/{x}/{y}&quot;,\n                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_abd1b4dcc6f5dfcfe61904dc5436bded);\n        \n    \n            var side_by_side_layers_ce211446cdd95d85615d79a7b773662d = L.control.sideBySide(\n                tile_layer_142f8abcf036db58d3cd37e955e4581d, tile_layer_1c4443772780c4304e848d16b4780df3\n            ).addTo(map_abd1b4dcc6f5dfcfe61904dc5436bded);\n        \n    \n            var layer_control_430626531d67b057a953a51dd8cc4d68 = {\n                base_layers : {\n                    &quot;openstreetmap&quot; : tile_layer_103f7a29edc7a9f11123dd6ccca13ff9,\n                },\n                overlays :  {\n                    &quot;Google Maps&quot; : tile_layer_28dd10f4244495907baa11178e8ad662,\n                    &quot;Prefire Normalized Burn Ratio&quot; : tile_layer_142f8abcf036db58d3cd37e955e4581d,\n                    &quot;Postfire Normalized Burn Ratio&quot; : tile_layer_1c4443772780c4304e848d16b4780df3,\n                },\n            };\n            L.control.layers(\n                layer_control_430626531d67b057a953a51dd8cc4d68.base_layers,\n                layer_control_430626531d67b057a953a51dd8cc4d68.overlays,\n                {&quot;autoZIndex&quot;: true, &quot;collapsed&quot;: true, &quot;position&quot;: &quot;topright&quot;}\n            ).addTo(map_abd1b4dcc6f5dfcfe61904dc5436bded);\n        \n&lt;/script&gt;\n&lt;/html&gt;\" width=\"100%\" height=\"600\"style=\"border:none !important;\" \"allowfullscreen\" \"webkitallowfullscreen\" \"mozallowfullscreen\"></iframe>\n```\n:::\n:::\n\n\n## Adding Burn Severity map with levels of severity\n\n![image.png](img/dnbreqn.png)\n\nA higher value of dNBR indicates more severe damage, while areas with negative dNBR values may indicate regrowth following a fire.\n\nTable 1. Burn severity levels obtained calculating dNBR, proposed by USGS. ![image.png](img/dnbrclass.png)\n\n::: {.cell execution_count=22}\n``` {.python .cell-code}\ndNBR_unscaled = preNBR.subtract(postNBR);\n\n#Scale product to USGS standards\ndNBR = dNBR_unscaled.multiply(1000);\n```\n:::\n\n\n::: {.cell execution_count=23}\n``` {.python .cell-code}\nMap2 = geemap.Map(center=[39.9, -122.9], zoom=8.7)\n```\n:::\n\n\n::: {.cell execution_count=24}\n``` {.python .cell-code}\nMap2.add_basemap('SATELLITE')\n```\n:::\n\n\n::: {.cell execution_count=25}\n``` {.python .cell-code}\n# dNBR greyscale\nMap2.addLayer(dNBR, {'min': -1000, 'max': 1000, 'palette': grey}, 'dNBR greyscale');\n```\n:::\n\n\n::: {.cell execution_count=26}\n``` {.python .cell-code}\n#Define an SLD style of discrete intervals to apply to the image.\nsld_intervals = '<RasterSymbolizer>' + '<ColorMap type=\"intervals\" extended=\"false\" >' + '<ColorMapEntry color=\"#ffffff\" quantity=\"-500\" label=\"-500\"/>' + '<ColorMapEntry color=\"#7a8737\" quantity=\"-250\" label=\"-250\" />' + '<ColorMapEntry color=\"#acbe4d\" quantity=\"-100\" label=\"-100\" />' + '<ColorMapEntry color=\"#0ae042\" quantity=\"100\" label=\"100\" />' + '<ColorMapEntry color=\"#fff70b\" quantity=\"270\" label=\"270\" />' + '<ColorMapEntry color=\"#ffaf38\" quantity=\"440\" label=\"440\" />' + '<ColorMapEntry color=\"#ff641b\" quantity=\"660\" label=\"660\" />' + '<ColorMapEntry color=\"#a41fd6\" quantity=\"2000\" label=\"2000\" />' + '</ColorMap>' + '</RasterSymbolizer>';\n```\n:::\n\n\n::: {.cell execution_count=27}\n``` {.python .cell-code}\nMap2.addLayer(dNBR.sldStyle(sld_intervals), {}, 'dNBR classified');\n#==========================================================================================\n#                                   ADD A LEGEND\n\nlegend_dict = {\n    \"Enhanced Regrowth, High\": '7a8737',\n    'Enhanced Regrowth, Low':  'acbe4d',\n    'Unburned': '0ae042',\n    'Low Severity': 'fff70b',\n    'Moderate-low Severity': 'ffaf38',\n    'Moderate-high Severity': 'ff641b',\n    'High Severity': 'a41fd6',\n    'NA': 'ffffff'}\n\n\nMap2.add_legend(title = \"dNBR Classes\", legend_dict = legend_dict)\nMap2\n```\n\n::: {.cell-output .cell-output-display execution_count=68}\n```{=html}\n<iframe srcdoc=\"&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    \n    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;\n    \n        &lt;script&gt;\n            L_NO_TOUCH = false;\n            L_DISABLE_3D = false;\n        &lt;/script&gt;\n    \n    &lt;style&gt;html, body {width: 100%;height: 100%;margin: 0;padding: 0;}&lt;/style&gt;\n    &lt;style&gt;#map {position:absolute;top:0;bottom:0;right:0;left:0;}&lt;/style&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://code.jquery.com/jquery-1.12.4.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/&gt;\n    \n            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,\n                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;\n            &lt;style&gt;\n                #map_1ae742cbd29f869ed72a85ce344da40b {\n                    position: relative;\n                    width: 100.0%;\n                    height: 100.0%;\n                    left: 0.0%;\n                    top: 0.0%;\n                }\n                .leaflet-container { font-size: 1rem; }\n            &lt;/style&gt;\n        \n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.2/Control.FullScreen.min.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.2/Control.FullScreen.min.css&quot;/&gt;\n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.css&quot;/&gt;\n    &lt;script src=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css&quot;/&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    \n    \n            &lt;div class=&quot;folium-map&quot; id=&quot;map_1ae742cbd29f869ed72a85ce344da40b&quot; &gt;&lt;/div&gt;\n        \n    \n&lt;!doctype html&gt;\n&lt;html lang=&quot;en&quot;&gt;\n&lt;head&gt;\n  &lt;meta charset=&quot;utf-8&quot;&gt;\n  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;\n  &lt;title&gt;jQuery UI Draggable - Default functionality&lt;/title&gt;\n  &lt;link rel=&quot;stylesheet&quot; href=&quot;//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css&quot;&gt;\n\n  &lt;script src=&quot;https://code.jquery.com/jquery-1.12.4.js&quot;&gt;&lt;/script&gt;\n  &lt;script src=&quot;https://code.jquery.com/ui/1.12.1/jquery-ui.js&quot;&gt;&lt;/script&gt;\n\n  &lt;script&gt;\n  $( function() {\n    $( &quot;#maplegend&quot; ).draggable({\n                    start: function (event, ui) {\n                        $(this).css({\n                            right: &quot;auto&quot;,\n                            top: &quot;auto&quot;,\n                            bottom: &quot;auto&quot;\n                        });\n                    }\n                });\n});\n\n  &lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n\n&lt;div id=&#x27;maplegend&#x27; class=&#x27;maplegend&#x27;\n    style=&#x27;position: absolute; z-index:9999; border:2px solid grey; background-color:rgba(255, 255, 255, 0.8);\n     border-radius:6px; padding: 10px; font-size:14px; right: 20px; bottom: 20px;&#x27;&gt;\n\n&lt;div class=&#x27;legend-title&#x27;&gt;dNBR Classes&lt;/div&gt;\n&lt;div class=&#x27;legend-scale&#x27;&gt;\n  &lt;ul class=&#x27;legend-labels&#x27;&gt;\n    &lt;li&gt;&lt;span style=&#x27;background:#7a8737;opacity:1.0;&#x27;&gt;&lt;/span&gt;Enhanced Regrowth, High&lt;/li&gt;\n    &lt;li&gt;&lt;span style=&#x27;background:#acbe4d;opacity:1.0;&#x27;&gt;&lt;/span&gt;Enhanced Regrowth, Low&lt;/li&gt;\n    &lt;li&gt;&lt;span style=&#x27;background:#0ae042;opacity:1.0;&#x27;&gt;&lt;/span&gt;Unburned&lt;/li&gt;\n    &lt;li&gt;&lt;span style=&#x27;background:#fff70b;opacity:1.0;&#x27;&gt;&lt;/span&gt;Low Severity&lt;/li&gt;\n    &lt;li&gt;&lt;span style=&#x27;background:#ffaf38;opacity:1.0;&#x27;&gt;&lt;/span&gt;Moderate-low Severity&lt;/li&gt;\n    &lt;li&gt;&lt;span style=&#x27;background:#ff641b;opacity:1.0;&#x27;&gt;&lt;/span&gt;Moderate-high Severity&lt;/li&gt;\n    &lt;li&gt;&lt;span style=&#x27;background:#a41fd6;opacity:1.0;&#x27;&gt;&lt;/span&gt;High Severity&lt;/li&gt;\n    &lt;li&gt;&lt;span style=&#x27;background:#ffffff;opacity:1.0;&#x27;&gt;&lt;/span&gt;NA&lt;/li&gt;\n  &lt;/ul&gt;\n&lt;/div&gt;\n&lt;/div&gt;\n\n&lt;/body&gt;\n&lt;/html&gt;\n\n&lt;style type=&#x27;text/css&#x27;&gt;\n  .maplegend .legend-title {\n    text-align: left;\n    margin-bottom: 5px;\n    font-weight: bold;\n    font-size: 90%;\n    }\n  .maplegend .legend-scale ul {\n    margin: 0;\n    margin-bottom: 5px;\n    padding: 0;\n    float: left;\n    list-style: none;\n    }\n  .maplegend .legend-scale ul li {\n    font-size: 80%;\n    list-style: none;\n    margin-left: 0;\n    line-height: 18px;\n    margin-bottom: 2px;\n    }\n  .maplegend ul.legend-labels li span {\n    display: block;\n    float: left;\n    height: 16px;\n    width: 30px;\n    margin-right: 5px;\n    margin-left: 0;\n    border: 1px solid #999;\n    }\n  .maplegend .legend-source {\n    font-size: 80%;\n    color: #777;\n    clear: both;\n    }\n  .maplegend a {\n    color: #777;\n    }\n&lt;/style&gt;\n\n&lt;/body&gt;\n&lt;script&gt;\n    \n    \n            var map_1ae742cbd29f869ed72a85ce344da40b = L.map(\n                &quot;map_1ae742cbd29f869ed72a85ce344da40b&quot;,\n                {\n                    center: [39.9, -122.9],\n                    crs: L.CRS.EPSG3857,\n                    zoom: 8.7,\n                    zoomControl: true,\n                    preferCanvas: false,\n                    eeInitialize: true,\n                    addGoogleMap: true,\n                    pluginLatlngpopup: false,\n                    pluginFullscreen: true,\n                    pluginDraw: true,\n                    DrawExport: false,\n                    pluginMinimap: false,\n                    locateControl: false,\n                    searchControl: true,\n                    layersControl: true,\n                }\n            );\n\n            \n\n        \n    \n            var tile_layer_a5007c45fb25b136c611cdb8d08385f4 = L.tileLayer(\n                &quot;https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,\n                {&quot;attribution&quot;: &quot;Data by \\u0026copy; \\u003ca target=\\&quot;_blank\\&quot; href=\\&quot;http://openstreetmap.org\\&quot;\\u003eOpenStreetMap\\u003c/a\\u003e, under \\u003ca target=\\&quot;_blank\\&quot; href=\\&quot;http://www.openstreetmap.org/copyright\\&quot;\\u003eODbL\\u003c/a\\u003e.&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 30, &quot;maxZoom&quot;: 30, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_1ae742cbd29f869ed72a85ce344da40b);\n        \n    \n            var tile_layer_28dd10f4244495907baa11178e8ad662 = L.tileLayer(\n                &quot;https://mt1.google.com/vt/lyrs=m\\u0026x={x}\\u0026y={y}\\u0026z={z}&quot;,\n                {&quot;attribution&quot;: &quot;Google&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 22, &quot;maxZoom&quot;: 22, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_1ae742cbd29f869ed72a85ce344da40b);\n        \n    \n            L.control.fullscreen(\n                {&quot;forceSeparateButton&quot;: false, &quot;position&quot;: &quot;topleft&quot;, &quot;title&quot;: &quot;Full Screen&quot;, &quot;titleCancel&quot;: &quot;Exit Full Screen&quot;}\n            ).addTo(map_1ae742cbd29f869ed72a85ce344da40b);\n        \n    \n            var options = {\n              position: &quot;topleft&quot;,\n              draw: {},\n              edit: {},\n            }\n            // FeatureGroup is to store editable layers.\n            var drawnItems = new L.featureGroup().addTo(\n                map_1ae742cbd29f869ed72a85ce344da40b\n            );\n            options.edit.featureGroup = drawnItems;\n            var draw_control_305ffb32188195774ea0dd8e419aa136 = new L.Control.Draw(\n                options\n            ).addTo( map_1ae742cbd29f869ed72a85ce344da40b );\n            map_1ae742cbd29f869ed72a85ce344da40b.on(L.Draw.Event.CREATED, function(e) {\n                var layer = e.layer,\n                    type = e.layerType;\n                var coords = JSON.stringify(layer.toGeoJSON());\n                layer.on(&#x27;click&#x27;, function() {\n                    alert(coords);\n                    console.log(coords);\n                });\n                drawnItems.addLayer(layer);\n             });\n            map_1ae742cbd29f869ed72a85ce344da40b.on(&#x27;draw:created&#x27;, function(e) {\n                drawnItems.addLayer(e.layer);\n            });\n            \n        \n    \n            L.Control.geocoder(\n                {&quot;collapsed&quot;: true, &quot;defaultMarkGeocode&quot;: true, &quot;position&quot;: &quot;topleft&quot;}\n            ).on(&#x27;markgeocode&#x27;, function(e) {\n                map_1ae742cbd29f869ed72a85ce344da40b.setView(e.geocode.center, 11);\n            }).addTo(map_1ae742cbd29f869ed72a85ce344da40b);\n\n        \n    \n            map_1ae742cbd29f869ed72a85ce344da40b.fitBounds(\n                [[39.9, -122.9], [39.9, -122.9]],\n                {&quot;maxZoom&quot;: 8.7}\n            );\n        \n    \n            var tile_layer_3dff3d132210a061e443581bfd0e2d40 = L.tileLayer(\n                &quot;https://mt1.google.com/vt/lyrs=s\\u0026x={x}\\u0026y={y}\\u0026z={z}&quot;,\n                {&quot;attribution&quot;: &quot;Google&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 22, &quot;maxZoom&quot;: 22, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_1ae742cbd29f869ed72a85ce344da40b);\n        \n    \n            var tile_layer_a1cecc51c7a770481c6cb49485450961 = L.tileLayer(\n                &quot;https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/834a86734a29bdcdc3f5b2c64e26215a-51ea2f3a761f0950ab988bb22f69a27f/tiles/{z}/{x}/{y}&quot;,\n                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_1ae742cbd29f869ed72a85ce344da40b);\n        \n    \n            var tile_layer_03600646184e7b881145274e1b48c864 = L.tileLayer(\n                &quot;https://earthengine.googleapis.com/v1alpha/projects/earthengine-legacy/maps/0d16288e8af6543335f7c0b2f64a39ca-39823811f6fb4af09930c0c8ae29e527/tiles/{z}/{x}/{y}&quot;,\n                {&quot;attribution&quot;: &quot;Google Earth Engine&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 24, &quot;maxZoom&quot;: 24, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1.0, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}\n            ).addTo(map_1ae742cbd29f869ed72a85ce344da40b);\n        \n    \n            var layer_control_eb6adf7e9ba4d78a9a1aaa54380496ab = {\n                base_layers : {\n                    &quot;openstreetmap&quot; : tile_layer_a5007c45fb25b136c611cdb8d08385f4,\n                },\n                overlays :  {\n                    &quot;Google Maps&quot; : tile_layer_28dd10f4244495907baa11178e8ad662,\n                    &quot;Google Satellite&quot; : tile_layer_3dff3d132210a061e443581bfd0e2d40,\n                    &quot;dNBR greyscale&quot; : tile_layer_a1cecc51c7a770481c6cb49485450961,\n                    &quot;dNBR classified&quot; : tile_layer_03600646184e7b881145274e1b48c864,\n                },\n            };\n            L.control.layers(\n                layer_control_eb6adf7e9ba4d78a9a1aaa54380496ab.base_layers,\n                layer_control_eb6adf7e9ba4d78a9a1aaa54380496ab.overlays,\n                {&quot;autoZIndex&quot;: true, &quot;collapsed&quot;: true, &quot;position&quot;: &quot;topright&quot;}\n            ).addTo(map_1ae742cbd29f869ed72a85ce344da40b);\n        \n&lt;/script&gt;\n&lt;/html&gt;\" width=\"100%\" height=\"600\"style=\"border:none !important;\" \"allowfullscreen\" \"webkitallowfullscreen\" \"mozallowfullscreen\"></iframe>\n```\n:::\n:::\n\n\n::: {.cell execution_count=28}\n``` {.python .cell-code}\n ## Derive extent of burn severity classes\n```\n:::\n\n\n::: {.cell tags='[]' execution_count=29}\n``` {.python .cell-code}\nthresholds = ee.Image([-1000, -251, -101, 99, 269, 439, 659, 2000]);\nclassified = dNBR.lt(thresholds).reduce('sum').toInt();\n```\n:::\n\n\n::: {.cell tags='[]' execution_count=30}\n``` {.python .cell-code}\n#count number of pixels in entire layer\nallpix =  classified.updateMask(classified); #mask the entire layer\n```\n:::\n\n\n::: {.cell tags='[]' execution_count=31}\n``` {.python .cell-code}\npixstats = allpix.reduceRegion(\n    reducer = ee.Reducer.count(),               # count pixels in a single class\n    geometry = aug_complex.geometry(),\n    scale = 30, \n    maxPixels = 10000000);\n```\n:::\n\n\n::: {.cell tags='[]' execution_count=32}\n``` {.python .cell-code}\nallpixels = ee.Number(pixstats.get('sum')); # extract pixel count as a number\n```\n:::\n\n\n::: {.cell tags='[]' execution_count=33}\n``` {.python .cell-code}\n#create an empty list to store area values in\narealist = [];\n```\n:::\n\n\n::: {.cell tags='[]' execution_count=34}\n``` {.python .cell-code}\n# create a function to derive extent of one burn severity class\n#arguments are class number and class name\ndef areacount(cnr, name):\n    singleMask =  classified.updateMask(classified.eq(cnr)); # mask a single class // count pixels in a single class\n    stats = singleMask.reduceRegion(reducer = ee.Reducer.count(), geometry = aug_complex.geometry(), scale = 30, \n    maxPixels = 10000000);\n    pix =  ee.Number(stats.get('sum'));\n    hect = pix.multiply(900).divide(10000);               #Landsat pixel = 30m x 30m --> 900 sqm\n    perc = pix.divide(allpixels).multiply(10000).round().divide(100);   # get area percent by class and round to 2 decimals\n    arealist.append({'Class': name, 'Pixels': pix, 'Hectares': hect, 'Percentage': perc});\n\n# severity classes in different order\nnames2 = ['NA', 'High Severity', 'Moderate-high Severity',\n'Moderate-low Severity', 'Low Severity','Unburned', 'Enhanced Regrowth, Low', 'Enhanced Regrowth, High'];\n```\n:::\n\n\n::: {.cell execution_count=35}\n``` {.python .cell-code}\ni = 0\nfor i in range(len(names2)):\n    if i < 8:\n        areacount(i, names2[i])\n        i + 1;\n```\n:::\n\n\n::: {.cell execution_count=36}\n``` {.python .cell-code}\ntest = pd.DataFrame(arealist)\n```\n:::\n\n\n::: {.cell execution_count=37}\n``` {.python .cell-code}\n# pop each class into its own variable, then create a dictionary that uses .getInfo() on each value to convert from ee.Number to number\n\n#NA = arealist[0:1].pop()\n#High_Severity = arealist[0:2].pop()\n#Moderate_high_Severity = arealist[0:3].pop()\n#Moderate_low_Severity = arealist[0:4].pop()\n#Low_Severity = arealist[0:5].pop()\n#Unburned = arealist[0:6].pop()\n#Enhanced_Regrowth_Low = arealist[0:7].pop()\n#Enhanced_Regrowth_High = arealist[0:8].pop()\n```\n:::\n\n\n::: {.cell execution_count=38}\n``` {.python .cell-code}\n# Takes quite a while to run\n\n#stats = {'Class': ['NA', 'High Severity', 'Moderate-high Severity', 'Moderate-low Severity', 'Low Severity', 'Unburned', 'Enhanced Regrowth, Low', 'Enhanced Regrowth, High'], \n#  'Pixels': [NA['Pixels'].getInfo(), High_Severity['Pixels'].getInfo(), Moderate_high_Severity['Pixels'].getInfo(), Moderate_low_Severity['Pixels'].getInfo(), Low_Severity['Pixels'].getInfo(), Unburned['Pixels'].getInfo(), Enhanced_Regrowth_Low['Pixels'].getInfo(), Enhanced_Regrowth_High['Pixels'].getInfo() ],\n#  'Hectares': [NA['Hectares'].getInfo(), High_Severity['Hectares'].getInfo(), Moderate_high_Severity['Hectares'].getInfo(), Moderate_low_Severity['Hectares'].getInfo(), Low_Severity['Hectares'].getInfo(), Unburned['Hectares'].getInfo(), Enhanced_Regrowth_Low['Hectares'].getInfo(), Enhanced_Regrowth_High['Hectares'].getInfo()],\n#  'Percentage': [NA['Percentage'].getInfo(), High_Severity['Percentage'].getInfo(), Moderate_high_Severity['Percentage'].getInfo(), Moderate_low_Severity['Percentage'].getInfo(),Low_Severity['Percentage'].getInfo(), Unburned['Percentage'].getInfo(), Enhanced_Regrowth_Low['Percentage'].getInfo(),Enhanced_Regrowth_High['Percentage'].getInfo()]}\n```\n:::\n\n\n::: {.cell execution_count=39}\n``` {.python .cell-code}\nstats = {'Class': ['NA',\n  'High Severity',\n  'Moderate-high Severity',\n  'Moderate-low Severity',\n  'Low Severity',\n  'Unburned',\n  'Enhanced Regrowth, Low',\n  'Enhanced Regrowth, High'],\n 'Pixels': [0, 1067623, 989630, 968749, 1061877, 1522197, 427507, 237862],\n 'Hectares': [0,\n  96086.07,\n  89066.7,\n  87187.41,\n  95568.93,\n  136997.73,\n  38475.63,\n  21407.58],\n 'Percentage': [0, 17.01, 15.77, 15.44, 16.92, 24.26, 6.81, 3.79]}\ndf_stats = pd.DataFrame(stats).set_index('Class')\ndf_stats\n```\n\n::: {.cell-output .cell-output-display execution_count=80}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Pixels</th>\n      <th>Hectares</th>\n      <th>Percentage</th>\n    </tr>\n    <tr>\n      <th>Class</th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>NA</th>\n      <td>0</td>\n      <td>0.00</td>\n      <td>0.00</td>\n    </tr>\n    <tr>\n      <th>High Severity</th>\n      <td>1067623</td>\n      <td>96086.07</td>\n      <td>17.01</td>\n    </tr>\n    <tr>\n      <th>Moderate-high Severity</th>\n      <td>989630</td>\n      <td>89066.70</td>\n      <td>15.77</td>\n    </tr>\n    <tr>\n      <th>Moderate-low Severity</th>\n      <td>968749</td>\n      <td>87187.41</td>\n      <td>15.44</td>\n    </tr>\n    <tr>\n      <th>Low Severity</th>\n      <td>1061877</td>\n      <td>95568.93</td>\n      <td>16.92</td>\n    </tr>\n    <tr>\n      <th>Unburned</th>\n      <td>1522197</td>\n      <td>136997.73</td>\n      <td>24.26</td>\n    </tr>\n    <tr>\n      <th>Enhanced Regrowth, Low</th>\n      <td>427507</td>\n      <td>38475.63</td>\n      <td>6.81</td>\n    </tr>\n    <tr>\n      <th>Enhanced Regrowth, High</th>\n      <td>237862</td>\n      <td>21407.58</td>\n      <td>3.79</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n### Use Case Discussion\n\nWe found that nearly half of the burned area was determined to be between Moderate-Low to High severity. Additionally, the High severity area was the second largest percentage of area classified.\n\n::: {.cell execution_count=40}\n``` {.python .cell-code}\ndf_stats['Hectares'].sort_values().plot.bar(color = ['gold', 'olive', 'darkkhaki'  , 'orange', 'orangered', 'yellow','purple', 'springgreen' ], width = 0.75)\nplt.ylabel('Hectares')\nplt.title('Burn Severity Analysis of 2020 August Complex Fire')\n```\n\n::: {.cell-output .cell-output-display execution_count=81}\n```\nText(0.5, 1.0, 'Burn Severity Analysis of 2020 August Complex Fire')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-41-output-2.png){width=619 height=602}\n:::\n:::\n\n\n::: {.cell execution_count=41}\n``` {.python .cell-code}\n# Pie Chart of Percentage by Class\ndf_stats.plot(kind = 'pie', y = 'Percentage',\n              colors = ['floralwhite', 'purple', 'orangered'  , 'orange', 'yellow', 'springgreen','darkkhaki', 'olive' ],\n             legend= False)\nplt.title('Burn Severity Analysis of 2020 August Complex Fire')\n```\n\n::: {.cell-output .cell-output-display execution_count=82}\n```\nText(0.5, 1.0, 'Burn Severity Analysis of 2020 August Complex Fire')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-42-output-2.png){width=632 height=402}\n:::\n:::\n\n\n### Future Analyses\n\nWith more time, the data extracted could be analyzed with other characteristics of the environment, such as slope, aspect, wind direction, and humidity. These analyses would better inform wildfire researchers the nature of fires, how they spread, and what characteristics increase severity.\n\nAdditionally, this burn severity map can be compared to other wildfire burn severity maps as a function of time to see if the severity of the burns is getting worse. This would help inform wildfire researchers determine how quickly fires are increasingly negatively affecting the environment. Burn severity can also be compared temporally so that wildfire prevention can be implemented to the parts of the state most at risk.\n\n### References\n\n-   Sentinel data GEE page: https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S2\n-   USFS MTBS Shapefile GEE page: https://developers.google.com/earth-engine/datasets/catalog/USFS_GTAC_MTBS_burned_area_boundaries_v1#description\n-   MTBS Project Page: https://www.mtbs.gov/\n-   Step by Step: Burn Severity mapping in Google Earth Engine https://code.earthengine.google.com/b455ba8cf4b5bee822bb7ff8935e6209\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}